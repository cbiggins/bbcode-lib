<?php

    /**
     * Copyright 2009 Michael Little, Christian Biggins
     *
     * This program is free software: you can redistribute it and/or modify
     * it under the terms of the GNU General Public License as published by
     * the Free Software Foundation, either version 3 of the License, or
     * (at your option) any later version.
     *
     * This program is distributed in the hope that it will be useful,
     * but WITHOUT ANY WARRANTY; without even the implied warranty of
     * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
     * GNU General Public License for more details.
     *
     * You should have received a copy of the GNU General Public License
     * along with this program. If not, see <http://www.gnu.org/licenses/>.
     */

    /**
     * BBCode library. A library for converting bbcode to HTML and vice versa
     *
     * Version: 1.0.0 BETA
     * Last Modified: 13/01/2009
     */

class FLQ_bbcode {

    public $bbcode_str = array(
                    'bold_open' => '[b]',
                    'bold_close' => '[/b]',
                    'italic_open' => '[i]',
                    'italic_close' => '[/i]',
                    'underline_open' => '[u]',
                    'underline_clode' => '[/u]',
                    'strikethrough_open' => '[s]',
                    'strikethrough_clode' => '[/s]'
    );

    public $bbcode_regex = array(
                    'url_open' => '/\[url=(^[\]]+)\]/i', 
                    'url_close' => '[/url]'
    );

    public $html_str = array(
                    'bold_open' => '<strong>',
                    'bold_close' => '</strong>',
                    'italic_open' => '<em>',
                    'italic_close' => '</em>',
                    'underline_open' => '<span style="text-decoration: underline;">',
                    'underline_clode' => '</span>',
                    'strikethrough_open' => '<span style="text-decoration: line-through;">',
                    'strikethrough_clode' => '</span>'
    );

    public $html_regex = array(
                    'url_open' => '/<a href=(\'|")(^[\]]+)(\'|")>/i',
                    'url_close' => '</a>'
    );

    public $str;

    function __construct($str) {
        $this->str = $str;
    }

    // Output current string as HTML standards compliant code
    public function toHTML($encoded = false) {
        if (!$encoded) {
            return str_replace($this->bbcode_str, $this->html_str, $this->str);
        } else {
            return htmlentities(str_replace($this->bbcode_str, $this->html_str, $this->str));
        }
    }

    public function toBBCode() {
        return str_replace($this->html_str, $this->bbcode_str, $this->str);
    }
}